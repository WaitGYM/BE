# π‹οΈβ€β™‚οΈ ν—¬μ¤μ¥ μ›¨μ΄ν… μ‹μ¤ν… (Gym Waiting System)

> **μ‹¤μ‹κ°„ κΈ°κµ¬ λ€κΈ°μ—΄ κ΄€λ¦¬ μ‹μ¤ν…** - μ¤„μ„κΈ° λ°©μ‹μΌλ΅ κ³µμ •ν•κ³  ν¨μ¨μ μΈ ν—¬μ¤μ¥ κΈ°κµ¬ μ‚¬μ©

## π“– κ°μ”

κΈ°μ΅΄μ λ³µμ΅ν• **μ‹κ°„ μμ•½ μ‹μ¤ν…**μ„ λ„μ–΄μ„ , μ‹¤μ  ν—¬μ¤μ¥ ν™κ²½μ— μµμ ν™”λ **μ›¨μ΄ν…(λ€κΈ°μ—΄) μ‹μ¤ν…**μ…λ‹λ‹¤. 
μ‹κ°„μ„ λ―Έλ¦¬ μ •ν•μ§€ μ•κ³ , ν„μ¥μ—μ„ **"μ¤„μ„κΈ°"** λ°©μ‹μΌλ΅ μμ„λ¥Ό κΈ°λ‹¤λ¦° ν›„, **μ„ΈνΈλ³„ μ΄λ™ μ§„ν–‰μ„ μ‹¤μ‹κ°„ μ¶”μ **ν•μ—¬ μλ™μΌλ΅ λ‹¤μ μ‚¬λμ—κ² λ„μ–΄κ°€λ” μμ—°μ¤λ¬μ΄ ν”λ΅μ°λ¥Ό μ κ³µν•©λ‹λ‹¤.

### π― ν•µμ‹¬ μ•„μ΄λ””μ–΄
- **β μ‹κ°„ μμ•½**: "μ¤ν›„ 2μ‹λ¶€ν„° 3μ‹κΉμ§€ λ²¤μΉν”„λ μ¤ μμ•½"
- **β… μ›¨μ΄ν…**: "λ²¤μΉν”„λ μ¤ λ€κΈ° β†’ μ•λ¦Ό λ°›κΈ° β†’ 3μ„ΈνΈ μ΄λ™ β†’ μλ™ μ™„λ£"

## β¨ μ£Όμ” νΉμ§•

### π”” **μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν…**
- WebSocket κΈ°λ° μ¦‰μ‹ μ•λ¦Ό
- λΈλΌμ°μ € ν‘Έμ‹ μ•λ¦Ό + μ§„λ™(λ¨λ°”μΌ)
- 5λ¶„ μ μμ‹κ°„ μλ™ κ΄€λ¦¬

### π‹οΈ **μ„ΈνΈλ³„ μ΄λ™ μ§„ν–‰ μ¶”μ **
- 1~20μ„ΈνΈ μμ  μ„¤μ • (κΈ°λ³Έ 3μ„ΈνΈ)
- μ„ΈνΈ μ™„λ£ β†’ μλ™ ν΄μ‹ νƒ€μ΄λ¨Έ β†’ λ‹¤μ μ„ΈνΈ μ‹μ‘
- λ§μ§€λ§‰ μ„ΈνΈ μ™„λ£ μ‹ **μλ™μΌλ΅ λ‹¤μ μ‚¬λμ—κ²**
- μ‹¤μ‹κ°„ μ§„ν–‰λ¥  ν‘μ‹ λ° λ‚¨μ€ ν΄μ‹μ‹κ°„ μΉ΄μ΄νΈλ‹¤μ΄

### π“± **μ§κ΄€μ μΈ μ‚¬μ© κ²½ν—**
- **μ‹κ°„ μ…λ ¥ λ¶ν•„μ”** - λ€κΈ°μ—΄ λ“±λ΅λ§ ν•λ©΄ λ
- ν„μ¬ μƒνƒ ν•λμ— νμ•… (μ΄λ™ μ¤‘ vs ν΄μ‹ μ¤‘)
- μ μ—°ν• μ μ–΄ (ν΄μ‹ κ±΄λ„λ›°κΈ°, μ΄λ™ μ¤‘λ‹¨)
- ν¬λ΅μ¤ ν”λ«νΌ λ°μ‘ν• μ§€μ›

### π”„ **μλ™ λ€κΈ°μ—΄ κ΄€λ¦¬**
- κ³µμ •ν• FIFO(First In, First Out) μμ„
- μ·¨μ†/λ§λ£ μ‹ μλ™ μλ² μ¬λ°°μΉ
- μ‹¤μ‹κ°„ λ€κΈ° ν„ν™© λ¨λ‹ν„°λ§


## π›  κΈ°μ  μ¤νƒ

### Backend
- **Node.js** + **Express.js** - REST API μ„λ²„
- **WebSocket (ws)** - μ‹¤μ‹κ°„ ν†µμ‹ 
- **Prisma ORM** - λ°μ΄ν„°λ² μ΄μ¤ κ΄€λ¦¬
- **PostgreSQL** - λ°μ΄ν„°λ² μ΄μ¤
- **Passport.js** - Google OAuth μΈμ¦
- **JWT** - ν† ν° κΈ°λ° μΈμ¦

## π— μ‹μ¤ν… μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    HTTP/WS     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    Prisma    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                 β”‚β—„β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Ίβ”‚                 β”‚β—„β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Ίβ”‚                 β”‚
β”‚   React Client  β”‚                β”‚  Express Server β”‚              β”‚   PostgreSQL    β”‚
β”‚                 β”‚                β”‚   + WebSocket   β”‚              β”‚                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”              β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
         β–²                                    β–²
         β”‚                                    β”‚
         β–Ό                                    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Browser Push   β”‚                β”‚   Google OAuth  β”‚
β”‚  Notifications  β”‚                β”‚   Authentication β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## π“ λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

### ν•µμ‹¬ ν…μ΄λΈ”

#### 1. EquipmentUsage (κΈ°κµ¬ μ‚¬μ© ν„ν™©)
```sql
- id: κ³ μ  ID
- equipmentId: κΈ°κµ¬ ID (FK)
- userId: μ‚¬μ©μ ID (FK)
- totalSets: μ „μ²΄ μ„ΈνΈ μ (1~20)
- currentSet: ν„μ¬ μ„ΈνΈ (1λ¶€ν„° μ‹μ‘)
- restMinutes: μ„ΈνΈκ°„ ν΄μ‹ μ‹κ°„ (0~10λ¶„)
- status: μ „μ²΄ μƒνƒ (IN_USE, COMPLETED)
- setStatus: μ„ΈνΈ μƒνƒ (EXERCISING, RESTING, COMPLETED, STOPPED)
- startedAt: μ΄λ™ μ‹μ‘ μ‹κ°„
- currentSetStartedAt: ν„μ¬ μ„ΈνΈ μ‹μ‘ μ‹κ°„
- restStartedAt: ν΄μ‹ μ‹μ‘ μ‹κ°„
- endedAt: μ΄λ™ μ™„λ£ μ‹κ°„
```

#### 2. WaitingQueue (λ€κΈ°μ—΄)
```sql
- id: κ³ μ  ID
- equipmentId: κΈ°κµ¬ ID (FK)
- userId: μ‚¬μ©μ ID (FK)
- queuePosition: λ€κΈ° μλ² (1, 2, 3...)
- status: λ€κΈ° μƒνƒ (WAITING, NOTIFIED, COMPLETED, CANCELLED, EXPIRED)
- createdAt: λ“±λ΅ μ‹κ°„
- notifiedAt: μ•λ¦Ό μ‹κ°„
```


### 3.λ°μ΄ν„°λ² μ΄μ¤ μ„¤μ •
```bash
# Prisma μ΄κΈ°ν™” (μ΄λ―Έ λμ–΄μλ‹¤λ©΄ μ¤ν‚µ)
npx prisma generate


### μ„λ²„ μ‹¤ν–‰
npm run dev

### 6. μ ‘μ† ν™•μΈ
μ„λ²„ μ‹μ‘ μ‹ λ‹¤μκ³Ό κ°™μ€ λ©”μ‹μ§€κ°€ μ¶λ ¥λ©λ‹λ‹¤:
```
π‰====================================π‰
π€ API μ„λ²„: http://localhost:4000
π” WebSocket: ws://localhost:4000/ws
π“± μ‹¤μ‹κ°„ μ•λ¦Ό: ν™μ„±ν™”
π—„οΈ  λ°μ΄ν„°λ² μ΄μ¤: μ—°κ²°λ¨
π ν™κ²½: development
π‰====================================π‰
```
## π“± μ‚¬μ© λ°©λ²•

### 1. νμ›κ°€μ… λ° λ΅κ·ΈμΈ
- Google κ³„μ •μΌλ΅ κ°„νΈ λ΅κ·ΈμΈ (OAuth 2.0)
- μµμ΄ λ΅κ·ΈμΈ μ‹ μλ™ νμ›κ°€μ…

### 2. κΈ°κµ¬ λ‘λ¬λ³΄κΈ°
- μΉ΄ν…κ³ λ¦¬λ³„ κΈ°κµ¬ λ©λ΅ (κ°€μ΄, λ“±, λ‹¤λ¦¬, μ–΄κΉ¨, ν”, μ μ‚°μ†, λ³µκ·Ό)
- μ‹¤μ‹κ°„ μ‚¬μ© ν„ν™© λ° λ€κΈ°μ—΄ μ •λ³΄ ν™•μΈ

### 3. μ›¨μ΄ν… μ‹μ¤ν… μ‚¬μ©ν•κΈ°

#### Case 1: κΈ°κµ¬κ°€ λΉ„μ–΄μμ„ λ•
```
1. κΈ°κµ¬ μ„ νƒ
2. μ΄λ™ μ„¤μ • (μ„ΈνΈ μ, ν΄μ‹ μ‹κ°„)
3. "λ°”λ΅ μ‹μ‘" ν΄λ¦­
4. μ„ΈνΈλ³„ μ΄λ™ μ§„ν–‰
5. μλ™ μ™„λ£ β†’ λ‹¤μ λ€κΈ°μμ—κ² μ•λ¦Ό
```

#### Case 2: κΈ°κµ¬κ°€ μ‚¬μ© μ¤‘μΌ λ•
```
1. κΈ°κµ¬ μ„ νƒ
2. "λ€κΈ°μ—΄ λ“±λ΅" ν΄λ¦­ β†’ μλ² λ°›κΈ°
3. λ€κΈ° μ¤‘ (μ‹¤μ‹κ°„ μλ² ν™•μΈ)
4. μ•λ¦Ό λ°›κΈ° "κΈ°κµ¬ μ‚¬μ© κ°€λ¥!" (5λ¶„ μ μμ‹κ°„)
5. "μ΄λ™ μ‹μ‘" ν΄λ¦­
6. μ„ΈνΈλ³„ μ΄λ™ μ§„ν–‰
7. μλ™ μ™„λ£ β†’ λ‹¤μ λ€κΈ°μμ—κ² μ•λ¦Ό
```

### 4. μ„ΈνΈλ³„ μ΄λ™ μ§„ν–‰
- **μ„ΈνΈ μ‹μ‘**: μλ™μΌλ΅ ν„μ¬ μ„ΈνΈ ν‘μ‹
- **μ„ΈνΈ μ™„λ£**: "μ„ΈνΈ μ™„λ£" λ²„νΌ β†’ μλ™ ν΄μ‹ μ‹μ‘
- **ν΄μ‹ μ¤‘**: μΉ΄μ΄νΈλ‹¤μ΄ νƒ€μ΄λ¨Έ β†’ μλ™μΌλ΅ λ‹¤μ μ„ΈνΈ
- **ν΄μ‹ κ±΄λ„λ›°κΈ°**: "λ‹¤μ μ„ΈνΈ μ‹μ‘" λ²„νΌμΌλ΅ μ¦‰μ‹ λ‹¤μ μ„ΈνΈ
- **μ΄λ™ μ¤‘λ‹¨**: "μ¤‘λ‹¨" λ²„νΌμΌλ΅ μ–Έμ λ“  μΆ…λ£ κ°€λ¥

## π”„ μ΄λ™ ν”λ΅μ° μƒμ„Έ

### π― **μ„ΈνΈλ³„ μ§„ν–‰ μμ‹** (3μ„ΈνΈ, 3λ¶„ ν΄μ‹)

```mermaid
graph TD
    A[μ΄λ™ μ‹μ‘] --> B[μ„ΈνΈ 1 μ΄λ™ μ¤‘]
    B --> C[μ„ΈνΈ μ™„λ£ λ²„νΌ]
    C --> D[3λ¶„ ν΄μ‹ νƒ€μ΄λ¨Έ]
    D --> E[μλ™μΌλ΅ μ„ΈνΈ 2 μ‹μ‘]
    E --> F[μ„ΈνΈ μ™„λ£ λ²„νΌ]
    F --> G[3λ¶„ ν΄μ‹ νƒ€μ΄λ¨Έ]
    G --> H[μλ™μΌλ΅ μ„ΈνΈ 3 μ‹μ‘]
    H --> I[μ„ΈνΈ μ™„λ£ λ²„νΌ]
    I --> J[π‰ μ „μ²΄ μ΄λ™ μ™„λ£]
    J --> K[λ‹¤μ λ€κΈ°μμ—κ² μλ™ μ•λ¦Ό]
    
    D --> L[ν΄μ‹ κ±΄λ„λ›°κΈ°]
    L --> E
    G --> M[ν΄μ‹ κ±΄λ„λ›°κΈ°]
    M --> H
    
    B --> N[μ΄λ™ μ¤‘λ‹¨]
    E --> N
    H --> N
    N --> K
```
## π― API μ—”λ“ν¬μΈνΈ

### μΈμ¦ κ΄€λ ¨
```http
GET    /api/auth/google              # Google OAuth λ΅κ·ΈμΈ
GET    /api/auth/google/callback     # OAuth μ½λ°±
POST   /api/auth/logout              # λ΅κ·Έμ•„μ›ƒ
GET    /api/auth/me                  # ν„μ¬ μ‚¬μ©μ μ •λ³΄
```

### κΈ°κµ¬ κ΄€λ ¨
```http
GET    /api/equipment                # κΈ°κµ¬ λ©λ΅ μ΅°ν
GET    /api/equipment/categories     # μΉ΄ν…κ³ λ¦¬ λ©λ΅
GET    /api/equipment/:id            # κΈ°κµ¬ μƒμ„Έ μ •λ³΄
```

### μ›¨μ΄ν… μ‹μ¤ν… - λ€κΈ°μ—΄ κ΄€λ¦¬
```http
POST   /api/waiting/queue/:equipmentId          # λ€κΈ°μ—΄ λ“±λ΅
DELETE /api/waiting/queue/:queueId              # λ€κΈ°μ—΄ μ·¨μ†
GET    /api/waiting/status/:equipmentId         # κΈ°κµ¬ μƒνƒ μ΅°ν
GET    /api/waiting/my-queues                   # λ‚΄ λ€κΈ°μ—΄ ν„ν™©
```

### μ›¨μ΄ν… μ‹μ¤ν… - μ΄λ™ κ΄€λ¦¬
```http
POST   /api/waiting/start-using/:equipmentId    # μ΄λ™ μ‹μ‘
POST   /api/waiting/complete-set/:equipmentId   # μ„ΈνΈ μ™„λ£ (ν•µμ‹¬!)
POST   /api/waiting/skip-rest/:equipmentId      # ν΄μ‹ κ±΄λ„λ›°κΈ°
POST   /api/waiting/stop-exercise/:equipmentId  # μ΄λ™ μ¤‘λ‹¨
GET    /api/waiting/exercise-status/:equipmentId # μ΄λ™ μƒνƒ μ΅°ν
```

### μ¦κ²¨μ°ΎκΈ°
```http
GET    /api/favorites                # μ¦κ²¨μ°ΎκΈ° λ©λ΅
POST   /api/favorites                # μ¦κ²¨μ°ΎκΈ° μ¶”κ°€
DELETE /api/favorites/equipment/:id  # μ¦κ²¨μ°ΎκΈ° μ κ±°
```

## π”” μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν…

### WebSocket μ—°κ²°
```javascript
// ν΄λΌμ΄μ–ΈνΈ μ—°κ²°
const ws = new WebSocket('ws://localhost:4000/ws')

// μΈμ¦
ws.send(JSON.stringify({
  type: 'auth',
  token: 'your-jwt-token'
}))

// μ•λ¦Ό μμ‹ 
ws.onmessage = (event) => {
  const data = JSON.parse(event.data)
  
  switch(data.type) {
    case 'EQUIPMENT_AVAILABLE':
      // π”” κΈ°κµ¬ μ‚¬μ© κ°€λ¥ (5λ¶„ μ μμ‹κ°„)
      showNotification(data.message)
      break
      
    case 'NEXT_SET_STARTED':
      // π‹οΈ λ‹¤μ μ„ΈνΈ μλ™ μ‹μ‘
      updateUI(data)
      break
      
    case 'QUEUE_EXPIRED':
      // β° λ€κΈ°μ—΄ μ‹κ°„ μ΄κ³Ό
      handleExpired(data)
      break
  }
}
```

### μ•λ¦Ό νƒ€μ… μƒμ„Έ

#### π”” **EQUIPMENT_AVAILABLE** - κΈ°κµ¬ μ‚¬μ© κ°€λ¥
```json
{
  "type": "EQUIPMENT_AVAILABLE",
  "title": "κΈ°κµ¬ μ‚¬μ© κ°€λ¥!",
  "message": "λ²¤μΉν”„λ μ¤ κΈ°κµ¬λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤! 5λ¶„ λ‚΄μ— μ‹μ‘ν•΄μ£Όμ„Έμ”.",
  "equipmentId": 1,
  "equipmentName": "λ²¤μΉν”„λ μ¤",
  "queueId": 123,
  "graceMinutes": 5,
  "urgency": "high"
}
```

#### π‹οΈ **NEXT_SET_STARTED** - λ‹¤μ μ„ΈνΈ μ‹μ‘
```json
{
  "type": "NEXT_SET_STARTED", 
  "title": "λ‹¤μ μ„ΈνΈ μ‹μ‘!",
  "message": "2/3 μ„ΈνΈλ¥Ό μ‹μ‘ν•μ„Έμ”",
  "equipmentId": 1,
  "equipmentName": "λ²¤μΉν”„λ μ¤",
  "currentSet": 2,
  "totalSets": 3
}
```

#### β° **QUEUE_EXPIRED** - λ€κΈ°μ—΄ λ§λ£
```json
{
  "type": "QUEUE_EXPIRED",
  "title": "λ€κΈ°μ—΄ μ‹κ°„ μ΄κ³Ό", 
  "message": "μ‹κ°„μ΄ μ΄κ³Όλμ–΄ λ€κΈ°μ—΄μ—μ„ μ κ±°λμ—μµλ‹λ‹¤.",
  "equipmentId": 1,
  "equipmentName": "λ²¤μΉν”„λ μ¤"
}
```




## π“ μ„±λ¥ μµμ ν™”

### WebSocket μµμ ν™”
- **μ—°κ²° ν’€ κ΄€λ¦¬**: λΉ„ν™μ„± μ—°κ²° μλ™ μ •λ¦¬ (5λ¶„)
- **Heartbeat**: 30μ΄λ§λ‹¤ ping/pongμΌλ΅ μ—°κ²° μƒνƒ ν™•μΈ
- **μλ™ μ¬μ—°κ²°**: λ„¤νΈμ›ν¬ λκΉ€ μ‹ μ§€μ λ°±μ¤ν”„λ΅ μ¬μ—°κ²°
- **λ©”λ¨λ¦¬ κ΄€λ¦¬**: WeakMap μ‚¬μ©μΌλ΅ λ©”λ¨λ¦¬ λ„μ λ°©μ§€

```




## π”’ λ³΄μ• κ³ λ ¤μ‚¬ν•­

### μΈμ¦ λ° μΈκ°€
- JWT ν† ν° κΈ°λ° μΈμ¦
- Google OAuth 2.0 λ³΄μ• νλ¦„
- μ„Έμ… κ΄€λ¦¬ λ° ν† ν° κ°±μ‹ 

### λ°μ΄ν„° λ³΄νΈ
```javascript
// μ…λ ¥ λ°μ΄ν„° κ²€μ¦
const { z } = require('zod')

const equipmentSchema = z.object({
  equipmentId: z.number().int().positive(),
  sets: z.number().int().min(1).max(20),
  restMinutes: z.number().int().min(1).max(10)
})
```


